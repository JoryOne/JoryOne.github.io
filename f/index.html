<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Jory|FM</title>
    <link rel="icon" href="../favicon.ico?v=1.1" />
    <link type="text/css"rel="stylesheet"  href="../style.css"/>
    <link type="text/css"rel="stylesheet"  href="http://cdn.bootcss.com/ionicons/2.0.1/css/ionicons.min.css"/>
</head>
<body>
<div class="jory">
    <div class="sidebar">
        <div class="header">
            <h1>J-FM</h1>
            <div class="fm-container animate-init">
                <h3 id="musicTitle">朱七-青春</h3>
                <div>
                    <audio id="music">
                        <source src="http://orzpa0sf9.bkt.clouddn.com/zq-qc.mp3">
                    </audio>
                    <div id="musicTime">0:00/0:00</div>
                    <span onClick="play()" class="ion-ios-play fm-icon" ></span>
                    <span onClick="play()" class="ion-ios-pause fm-icon hidden" ></span>
                    <span onClick="randomPlay()" class="ion-ios-skipforward fm-icon" ></span>
                    <span class="ion-arrow-down-a fm-icon" ></span>
                </div>
                <div class="process-bar"></div>
            </div>
            <div class="quote">
                <p class="quote-text animate-init" id="beautyWord">找一个下午，伴随着音乐，咖啡，和落地窗，静静地做一个世界的旁观者。</p>
            </div>
        </div>
        <div class="menu">
            <a href="/" class="animate-init">Home</a>
            <a href="/n" class="animate-init">Notes</a>
            <a href="https://github.com/JoryOne" class="animate-init">GitHub</a>
            <a href="https://coding.net/u/JoryOne" class="animate-init">Coding</a>
        </div>
        <div class="location">
            <span class="animate-init ion-ios-location-outline" style="font-size:20px;display: inline-block;"></span>
            <span class="location-text animate-init ">Beijing - China</span>
        </div>
    </div>
</div>
<script type="text/javascript" src="http://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
    var timer = null;
    $(document).ready(function () {
        var delay = 1;
        var DELAY_STEP = 200;
        var animationOptions = { opacity: 1, top: 0};

        $('h1').animate(animationOptions).promise()
                .pipe(animateMain)
                .pipe(animateLocationIcon);

        function animateMain() {
            var dfd = $.Deferred();
            var els = $('.animate-init');
            var size = els.length;

            els.each(function (index, el) {
                delay++;
                $(el).delay(index * DELAY_STEP)
                        .animate(animationOptions);
                (size - 1 === index) && dfd.resolve();
            });
            return dfd.promise();
        }

        function animateLocationIcon() {
            $('.location-icon').delay(delay * DELAY_STEP).animate({
                opacity: 1,
                top: 0
            }).promise().done();
        }
        var music = document.getElementById('music');
        function play(){
            if(music.paused){
                $(".ion-ios-play").hide();
                $(".ion-ios-pause").show();
                music.play();
                if(!timer){
                    timer = setInterval("musicChange()",50)
                }
            }
            else{
                clearInterval(timer);
                timer = null;
                $(".ion-ios-pause").hide();
                $(".ion-ios-play").show();
                music.pause();
            }
        }
        function musicChange(){
            var cur = music.currentTime || 0;
            var all = music.duration || 0;
            var curSec = parseInt(cur%60);
            curSec = curSec < 10 ? '0' + curSec : curSec;
            $('#musicTime').html(parseInt(cur/60) +':' + curSec +'/' +  parseInt(all/60) +':' + parseInt(all%60));
            var percentage = cur/all * 100 + '%';
            $(".process-bar").css('width',percentage);
        }
        music.onended = function(){
            clearInterval(timer);
            timer = null;
            $(".process-bar").css('width','0%');
            randomPlay();
        }

        var list = {
                    "data":[
                                {
                                        "title":"朱七-青春",
                                        "src":"http://orzpa0sf9.bkt.clouddn.com/zq-qc.mp3"
                               },
                                {
                                        "title":" 赵雷-青春无处安放",
                                        "src":"http://orzpa0sf9.bkt.clouddn.com/zl-qcwuaf.mp3"
                               },
                                {
                                        "title":" 靳松-独自旅行",
                                        "src":"http://orzpa0sf9.bkt.clouddn.com/js-dzlx.mp3"
                               },
                                {
                                        "title":" 靳松-老路小路",
                                        "src":"http://orzpa0sf9.bkt.clouddn.com/js-llxl.mp3"
                               }
                    ]
            };
        var listData = list.data;
        var listLength = listData.length;
        var currentMusic = parseInt(Math.random() * listLength);
        var newMusic = currentMusic;
        function randomPlay(){
            $('#musicTime').html("0:00/0:00");
            while(listLength > 1 && newMusic===currentMusic){
                newMusic = parseInt(Math.random() * listLength);
            }
            currentMusic = newMusic;
            $("#musicTitle").html(listData[currentMusic]['title']);
            music.src = listData[currentMusic]['src'];

            $(".ion-ios-play").hide();
            $(".ion-ios-pause").show();
            music.play();
            if(!timer){
                timer = setInterval("musicChange()",50)
            }
            $(".process-bar").css('width','0%');
        }

        window.play = play;
        window.randomPlay = randomPlay;
        window.musicChange = musicChange;

    });

    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?64933df303a2df479620f304600af522";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>
</body>
</html>
